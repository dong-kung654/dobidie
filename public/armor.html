<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방어구</title>
    <style>
        /* 기본 박스 스타일 */
        .result-box {
            border: 1px solid #ccc;
            padding: 6px;
            margin: 6px 0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        /* 제목 스타일 */
        .result-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* 항목들을 가로로 나열 */
        .result-info {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 6px;
        }

        .result-info div {
            width: calc(20% - 6px); /* 10개 항목을 가로로 배치 */
            box-sizing: border-box;   /* padding과 border가 width에 포함되도록 설정 */
        }

        .result-info.full-info {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;  /* 항목들 사이의 간격 */
            margin-bottom: 6px;
        }

        .result-info.full-info div {
            width: calc(25% - 6px);  /* 각 항목을 가로로 4개씩 배치 */
            box-sizing: border-box;
        }

        /* 작은 화면에서 한 줄에 표시할 항목 수를 줄이기 위한 미디어 쿼리 */
        @media (max-width: 768px) {
        .result-info div {
            width: calc(50% - 6px);  /* 2개 항목을 가로로 배치 */
            }
        .result-info.full-info div {
            width: calc(50% - 6px);  /* 2개 항목을 한 줄에 배치 */
            }
        }   

        @media (max-width: 480px) {
        .result-info div {
            width: 100%;  /* 화면이 더 작아지면 한 항목씩 세로로 배치 */
            }
        .result-info.full-info div {
            width: 100%;  /* 1개 항목씩 세로로 배치 */
            }
        }
        /* 검색 창 스타일 */
        #searchBox {
            width: 80%;
            padding: 10px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* 검색 버튼 스타일 */
        #searchButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #searchButton:hover {
            background-color: #45a049;
        }

        /* 검색 박스 레이아웃 */
        .search-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>방어구</h1>
    
    <!-- 검색 창 및 검색 버튼 -->
    <div class="search-container">
        <input type="text" id="searchBox" placeholder="검색어를 입력하세요..." />
        <button id="searchButton">검색</button>
    </div>

    <div id="results"></div>

    <script>
        // 검색에 사용할 파일 목록 (무기 관련 파일로 수정)
        const files = {
            "armor": "assets/armor.json"
        };

        // 검색 함수
        async function search() {
            const query = document.getElementById('searchBox').value.toLowerCase();
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';  // 이전 검색 결과 초기화

            if (!query) {
                alert("검색어를 입력해주세요.");
                return;
            }

            try {
                const data = await Promise.all(Object.values(files).map(file => fetchData(file)));
                const [armorData] = data;

                const filteredarmors = armorData.filter(armor => armor.name.toLowerCase().includes(query));
                if (filteredarmors.length === 0) {
                    resultsContainer.innerHTML = "<p>검색 결과가 없습니다.</p>";
                    return;
                }

                filteredarmors.forEach(armor => displayResult(armor));
            } catch (error) {
                console.error("데이터를 가져오는 중 오류가 발생했습니다:", error);
            }
        }

        // 파일 데이터를 fetch하는 함수
        async function fetchData(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`네트워크 응답이 정상이 아닙니다. 상태 코드: ${response.status}`);
            }
            return await response.json();
        }
            // 직업 사용 가능 여부를 판단하는 함수
        function getUsableJobs(armor) {
            const jobs = {
                "군": armor.use_royal,
                "기": armor.use_knight,
                "법": armor.use_mage,
                "엘": armor.use_elf,
                "다": armor.use_darkelf,
                "용": armor.use_dragonknight,
                "환": armor.use_blackwizard,
                "전": armor.use_warrior
                };
            // 모든 직업이 사용 가능하면 "전직업 사용 가능" 표시
            if (Object.values(jobs).every(v => v === 1)) {
                return "전직업 사용 가능";
            }

            // 사용 가능한 직업만 나열
            const usableJobs = Object.entries(jobs)
                .filter(([job, canUse]) => canUse === 1)
                .map(([job]) => job);

            return usableJobs.length > 0 ? usableJobs.join(", ") : "사용 불가";
            }


        function getStats(armor) {
             // 스텟 항목들을 객체로 묶음
            const stats = {
                "힘": armor.add_str,
                "콘": armor.add_con,
                "민": armor.add_dex,
                "인": armor.add_int,
                "위": armor.add_wis,
                "카": armor.add_cha
            };

            // 모든 스텟이 동일한지 체크 (0이나 undefined가 아닌 값들만 체크)
            const statValues = Object.values(stats);
            const uniqueValues = [...new Set(statValues.filter(v => v !== undefined && v !== 0))];

            // 모든 스텟이 동일하면 "모든 스텟 : 값" 표시
            if (uniqueValues.length === 1 && statValues.length === statValues.filter(v => v !== undefined && v !== 0).length) {
                return `모든 스텟 : ${uniqueValues[0]}`;
            }

            // 개별적으로 표시할 경우 (0이 아닌 값만 필터링)
            const statList = Object.entries(stats)
                .filter(([_, value]) => value !== undefined && value !== 0) // 0이나 undefined가 아닌 값만
                .map(([key, value]) => `${key} ${value}`);

            return statList.length > 0 ? statList.join(", ") : "";
        }

        // 조건에 맞는 항목만 표시하는 함수
        function displayConditionally(label, value) {
            if (value && value !== 0) {
                return `<div style="display:block;"><strong>${label}:</strong> ${value}</div>`;
            }
            return '';  // 값이 없거나 0이면 해당 항목을 아예 반환하지 않음
        }

        // 검색 결과 표시 함수 (무기 항목을 출력하도록 수정)
        function displayResult(armor) {
            const resultsContainer = document.getElementById('results');
            const resultBox = document.createElement('div');
            resultBox.className = 'result-box';

            // 무기 항목들을 표시
            const armorInfo = `
                <div class="result-title">${armor.name}</div>
                <div class="result-info">
                    <div><strong>아이템 ID:</strong> ${armor.item_id || '없음'}</div>
                    <div><strong>종류:</strong> ${armor.type || '없음'}</div>
                    <div><strong>무게:</strong> ${armor.weight/1000 || '없음'}</div>
                    <div><strong>AC:</strong> ${armor.ac || '없음'}</div>
                    <div><strong>안전인첸:</strong> ${armor.safenchant || '없음'}</div>
                    <div><strong>einhasadper:</strong> ${armor.einhasadper || '없음'}</div>
                    <div><strong>착용 직업:</strong> ${getUsableJobs(armor)}</div>
                </div>  
                <div class="result-info">
                    <div><strong>헤이스트:</strong> ${armor.haste_item ? '있음' : '없음'}</div>
                    <div><strong>축복:</strong> ${armor.bless ? '있음' : '없음'}</div>
                    <div><strong>거래 가능:</strong> ${armor.trade ? '가능' : '불가'}</div>
                    <div><strong>삭제 불가:</strong> ${armor.cant_delete ? '불가' : '가능'}</div>
                </div>
            `;
            const fullInfo = `
                <div class="result-info full-info">
                    ${displayConditionally("hp 증가", armor.add_hp)}
                    ${displayConditionally("hp 회복", armor.add_hpr)}
                    ${displayConditionally("MP 추가", armor.add_mp)}
                    ${displayConditionally("MP 회복", armor.add_mpr)}
                    ${displayConditionally("sp 증가", armor.add_sp)}
                    ${displayConditionally("추가 데미지", armor.dmgmodifier)}
                    ${displayConditionally("추가 명중", armor.hitmodifier)}
                    ${displayConditionally("원거리 데미지", armor.bow_hit_rate)}
                    ${displayConditionally("원거리 명중", armor.bow_dmg_rate)}
                    ${displayConditionally("마법피해", armor.magicdmgmodifier)}
                    ${displayConditionally("마법방어", armor.m_def)}
                    ${displayConditionally("더블찬스", armor.double_dmg_chance)}
                    ${displayConditionally("최소레벨", armor.min_lvl)}
                    ${displayConditionally("최대레벨", armor.max_lvl)}
                    ${displayConditionally("사용시간", armor.max_use_time)}
                    ${getStats(armor)}
                </div>
            `;
            const fullInfo2 = `
                <div class="result-info full-info">

                    ${displayConditionally("기술 내성", armor.ability_resis)}
                    ${displayConditionally("기술 적중", armor.ability_pierce)}
                    ${displayConditionally("정령 내성", armor.spirit_resis)}
                    ${displayConditionally("정령 적중", armor.spirit_pierce)}
                    ${displayConditionally("용언 내성", armor.dragonS_resis)}
                    ${displayConditionally("용언 적중", armor.dragonS_pierce)}
                    ${displayConditionally("공포 내성", armor.fear_resis)}
                    ${displayConditionally("공포 적중", armor.fear_pierce)}
                    ${displayConditionally("모든 내성", armor.all_resis)}
                    ${displayConditionally("모든 적중", armor.all_pierce)}
                </div>
            `;
            const fullInfo3 = `
                <div class="result-info full-info">
                    ${displayConditionally("물속성저항", armor.defense_water)}
                    ${displayConditionally("불속성저항", armor.defense_fire)}
                    ${displayConditionally("땅속성저항", armor.defense_earth)}
                    ${displayConditionally("바람속성저항", armor.defense_wind)}
                    ${displayConditionally("pvp 리덕", armor.PVPcalcPcDefense)}
                    ${displayConditionally("pvp 공격", armor.PVPweaponTotalDamage)}
                    ${displayConditionally("원거리 크리", armor.missile_critical_probability)}
                    ${displayConditionally("근거리 크리", armor.melee_critical_probability)}
                    ${displayConditionally("마법 적중", armor.magic_hit_up)}
                    ${displayConditionally("마법 이름", armor.Magic_name)}
                </div>
            `;

            resultBox.innerHTML = armorInfo + fullInfo + fullInfo2 + fullInfo3;
            resultsContainer.appendChild(resultBox);
        }

        // 검색 버튼 클릭 시 검색 실행
        document.getElementById('searchButton').addEventListener('click', search);
    </script>
</body>
</html>
