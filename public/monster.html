<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>몬스터</title>
    <style>
        /* 기본 박스 스타일 */
        .result-box {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        /* 제목 스타일 */
        .result-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* 항목들을 가로로 나열 */
        .result-info {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .result-info div {
            width: calc(12.5% - 10px); /* 8개 항목을 가로로 배치 */
        }

        /* 검색 창 스타일 */
        #searchBox {
            width: 80%;
            padding: 10px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* 검색 버튼 스타일 */
        #searchButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #searchButton:hover {
            background-color: #45a049;
        }

        /* 검색 박스 레이아웃 */
        .search-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>몬스터</h1>
    
    <!-- 검색 창 및 검색 버튼 -->
    <div class="search-container">
        <input type="text" id="searchBox" placeholder="검색어를 입력하세요..." />
        <button id="searchButton">검색</button>
    </div>

    <div>
        <label><input type="checkbox" id="allCheck" checked> 모두</label>
        <label><input type="checkbox" id="normalCheck"> 일반 (보스 제외)</label>
        <label><input type="checkbox" id="bossCheck"> 보스 (일반 제외)</label>
    </div>

    <div id="results"></div>

    <script>
        // 검색에 사용할 파일 목록
        const files = {
            "npc": "/assets/npc.json",
            "spawnlist": "/assets/spawnlist.json",
            "mapids": "/assets/mapids.json",
            "droplist_boss": "/assets/droplist_boss.json",
            "event_boss_time": "/assets/event_boss_time.json"
            //"spawnlist_npc": "/assets/spawnlist_npc.json",
            //"shop": "/assets/shop.json",
            //"armor": "/assets/armor.json",
            //"weapon": "/assets/weapon.json",
            //"expitem": "/assets/expitem.json",
            //"etcitem": "/assets/etcitem.json",
            //"droplist": "/assets/droplist.json"
        };

        // 검색 함수
        async function search() {
            const query = document.getElementById('searchBox').value.toLowerCase();
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';  // 이전 검색 결과 초기화

            if (!query) {
                alert("검색어를 입력해주세요.");
                return;
            }
            const allCheck = document.getElementById('allCheck').checked;
            const normalCheck = document.getElementById('normalCheck').checked;
            const bossCheck = document.getElementById('bossCheck').checked;

            console.log('검색어:', query);
            console.log('모두 체크:', allCheck, '일반 체크:', normalCheck, '보스 체크:', bossCheck);


            try {
                const data = await Promise.all(Object.values(files).map(file => fetchData(file)));
                const [npcData, spawnlistData, mapidsData, droplistBossData, eventBossData] = data;

                // NPC 필터링
                const filteredNPCs = npcData.filter(npc => npc.name.toLowerCase().includes(query));

                // 보스 여부 확인 함수
                const isBoss = (npc) => {
                    // droplist_boss에서 npc_id로 확인
                    const isBossFromDrop = droplistBossData.some(boss => boss.mobId === npc.npcid);
                    // event_boss_time에서 npcid로 확인
                    const isBossFromEvent = eventBossData.some(boss => boss.npcid === npc.npcid);
                    return isBossFromDrop || isBossFromEvent;
                };

                // 검색 결과 필터링
                const finalResults = filteredNPCs.filter(npc => {
                    const isNpcBoss = isBoss(npc);
                    if (allCheck) return true; // "모두" 선택 시 필터링 없이 결과 출력
                    if (normalCheck && !isNpcBoss) return true; // "일반" 선택 시 보스 제외
                    if (bossCheck && isNpcBoss) return true; // "보스" 선택 시 보스만 출력
                    return false;
                });

                if (finalResults.length === 0) {
                    resultsContainer.innerHTML = "<p>검색 결과가 없습니다.</p>";
                    return;
                }
                // 결과 출력
                finalResults.forEach(npc => {
                    const isNpcBoss = isBoss(npc);
                    const spawnlistEntries = spawnlistData.filter(entry => entry.npc_templateid === npc.npcid);
                    for (const entry of spawnlistEntries) {
                        const map = mapidsData.find(map => map.mapid === entry.mapid);
                        displayResult(npc, map, isNpcBoss); // 보스 여부도 함께 전달
                    }
                });

            } catch (error) {
                console.error("데이터를 가져오는 중 오류가 발생했습니다:", error);
            }
        }

        // 파일 데이터를 fetch하는 함수
        async function fetchData(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`네트워크 응답이 정상이 아닙니다. 상태 코드: ${response.status}`);
            }
            return await response.json();
        }

        function getWeaknessText(weakAttr) {

        switch (weakAttr) {
            case 1:
                return '땅';
            case 2:
                return '불';
            case 3:
                return '물';
            case 4:
                return '바람';
            default:
                return '없음';  // 숫자가 1, 2, 3, 4 외일 경우 '없음'으로 처리
            }
        }
        function getundeadText(undead) {

        switch (undead) {
            case 1:
                return '언데드';
            case 2:
                return '악마';
            case 3:
                return '언데드';
            case 4:
                return '모름';
            case 5:
                return '언데드';    
            default:
                return '모름';  // 숫자가 1, 2, 3, 4 외일 경우 '없음'으로 처리
            }
        }


        // 검색 결과 표시 함수
        function displayResult(npc, map, isBoss) {
            const resultsContainer = document.getElementById('results');
            const resultBox = document.createElement('div');
            resultBox.className = 'result-box';

            // 보스 표시 (보스일 경우 빨간색으로 "(보스)" 표시)
            const bossLabel = isBoss ? '<span style="color:red;">(보스)</span>' : '';

            // 모든 항목을 한 번에 표시
            const npcInfo = `
                <div class="result-title">${npc.name} (${npc.npcid}) ${bossLabel}</div>
                <div class="result-info">
                    <div><strong>레벨:</strong> ${npc.lvl || '없음'}</div>
                    <div><strong>HP:</strong> ${npc.hp || '없음'}</div>
                    <div><strong>MP:</strong> ${npc.mp || '없음'}</div>
                    <div><strong>ac:</strong> ${npc.ac || '없음'}</div>
                    <div><strong>MR:</strong> ${npc.mr || '없음'}</div>
                    <div><strong>EXP:</strong> ${npc.exp || '없음'}</div>
                </div>
                <div class="result-info">
                    <div><strong>힘:</strong> ${npc.str || '없음'}</div>
                    <div><strong>민첩:</strong> ${npc.dex || '없음'}</div>
                    <div><strong>체력:</strong> ${npc.con || '없음'}</div>
                    <div><strong>지혜:</strong> ${npc.wis || '없음'}</div>
                    <div><strong>지능:</strong> ${npc.intel || '없음'}</div>
                    <div><strong>매력:</strong> ${npc.cha || '없음'}</div>
                    <div><strong>크기:</strong> ${npc.size || '없음'}</div>
                </div>
                <div class="result-info">
                    <div><strong>약점 속성:</strong> ${getWeaknessText(npc.weakAttr)}</div>
                    <div><strong>언데드:</strong> ${getundeadText(npc.undead)}</div>
                    <div><strong>독 공격:</strong> ${npc.poison_atk || '안함'}</div>
                    <div><strong>마비 공격:</strong> ${npc.paralysis_atk || '안함'}</div>
                    <div><strong>리덕션:</strong> ${npc.damage_reduction || '없음'}</div>
                    <div><strong>손상:</strong> ${npc.hard || '안됨'}</div>
                    <div><strong>턴언데드:</strong> ${npc.IsTU || '불가'}</div>
                </div>
                <div class="result-info">
                    <div><strong>npc종류:</strong> ${npc.impl || '없음'}</div>
                    <div><strong>라우풀수치:</strong> ${npc.lawful || '없음'}</div>
                    <div><strong>출현 위치:</strong> ${map.locationname || '없음'}</div>
                </div>
            `;

            resultBox.innerHTML = npcInfo;
            resultsContainer.appendChild(resultBox);
        }

        // 검색 버튼 클릭 시 검색 실행
        document.getElementById('searchButton').addEventListener('click', search);

        // 체크박스 클릭 시 처리
        document.getElementById('allCheck').addEventListener('click', function() {
        document.getElementById('normalCheck').checked = false;
        document.getElementById('bossCheck').checked = false;
        });

        document.getElementById('normalCheck').addEventListener('click', function() {
        document.getElementById('allCheck').checked = false;
        document.getElementById('bossCheck').checked = false;
        });

        document.getElementById('bossCheck').addEventListener('click', function() {
        document.getElementById('allCheck').checked = false;
        document.getElementById('normalCheck').checked = false;
        });
    </script>
</body>
</html>


