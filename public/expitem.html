<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>경험치 아이템</title>
    <style>
        /* 기본 박스 스타일 */
        .result-box {
            border: 1px solid #ccc;
            padding: 6px;
            margin: 6px 0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        /* 제목 스타일 */
        .result-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        /* 항목들을 가로로 나열 */
        .result-info {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 6px;
        }

        .result-info div {
            width: calc(20% - 6px); /* 10개 항목을 가로로 배치 */
            box-sizing: border-box;   /* padding과 border가 width에 포함되도록 설정 */
        }

        .result-info.full-info {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;  /* 항목들 사이의 간격 */
            margin-bottom: 6px;
        }

        .result-info.full-info div {
            width: calc(25% - 6px);  /* 각 항목을 가로로 4개씩 배치 */
            box-sizing: border-box;
        }

        /* 작은 화면에서 한 줄에 표시할 항목 수를 줄이기 위한 미디어 쿼리 */
        @media (max-width: 768px) {
        .result-info div {
            width: calc(50% - 6px);  /* 2개 항목을 가로로 배치 */
            }
        .result-info.full-info div {
            width: calc(50% - 6px);  /* 2개 항목을 한 줄에 배치 */
            }
        }   

        @media (max-width: 480px) {
        .result-info div {
            width: 100%;  /* 화면이 더 작아지면 한 항목씩 세로로 배치 */
            }
        .result-info.full-info div {
            width: 100%;  /* 1개 항목씩 세로로 배치 */
            }
        }
        /* 검색 창 스타일 */
        #searchBox {
            width: 80%;
            padding: 10px;
            font-size: 1.1em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        /* 검색 버튼 스타일 */
        #searchButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            font-size: 1.1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #searchButton:hover {
            background-color: #45a049;
        }

        /* 검색 박스 레이아웃 */
        .search-container {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>경험치 아이템</h1>
    
    <!-- 검색 창 및 검색 버튼 -->
    <div class="search-container">
        <input type="text" id="searchBox" placeholder="검색어를 입력하세요..." />
        <button id="searchButton">검색</button>
    </div>

    <div id="results"></div>

    <script>
        // 검색에 사용할 파일 목록 (무기 관련 파일로 수정)
        const files = {
            "expitem": "/assets/expitem.json"
        };

        // 검색 함수
        async function search() {
            const query = document.getElementById('searchBox').value.toLowerCase();
            const resultsContainer = document.getElementById('results');
            resultsContainer.innerHTML = '';  // 이전 검색 결과 초기화

            try {
                const data = await Promise.all(Object.values(files).map(file => fetchData(file)));
                const [expitemData] = data;

                // 검색어가 있으면 필터링, 없으면 전체 데이터 표시
                const filteredexpitems = query ? 
                    expitemData.filter(expitem => expitem.name.toLowerCase().includes(query)) :
                    expitemData;

                if (filteredexpitems.length === 0) {
                    resultsContainer.innerHTML = "<p>검색 결과가 없습니다.</p>";
                    return;
                }

                filteredexpitems.forEach(expitem => displayResult(expitem));
            } catch (error) {
                console.error("데이터를 가져오는 중 오류가 발생했습니다:", error);
            }
        }

        // 파일 데이터를 fetch하는 함수
        async function fetchData(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error(`네트워크 응답이 정상이 아닙니다. 상태 코드: ${response.status}`);
            }
            return await response.json();
        }


        // 조건에 맞는 항목만 표시하는 함수
        function displayConditionally(label, value) {
            if (value && value !== 0) {
                return `<div style="display:block;"><strong>${label}:</strong> ${value}</div>`;
            }
            return '';  // 값이 없거나 0이면 해당 항목을 아예 반환하지 않음
        }

        // 검색 결과 표시 함수 (무기 항목을 출력하도록 수정)
        function displayResult(expitem) {
            const resultsContainer = document.getElementById('results');
            const resultBox = document.createElement('div');
            resultBox.className = 'result-box';

            // 무기 항목들을 표시
            const expitemInfo = `
                <div class="result-title">${expitem.name}</div>
                <div class="result-info">
                    <div><strong>아이템 ID:</strong> ${expitem.item_id || '없음'}</div>
                    <div><strong>종류:</strong> ${expitem.item_type || '없음'}</div>
                    <div><strong>사용타입:</strong> ${expitem.use_type || '없음'}</div>
                    <div><strong>무게:</strong> ${expitem.weight || '없음'}</div>
                    <div><strong>거래 가능:</strong> ${expitem.trade ? '가능' : '불가'}</div>
                    <div><strong>삭제 불가:</strong> ${expitem.cant_delete ? '불가' : '가능'}</div>
                </div>
            
            `;
            const fullInfo = `
                <div class="result-info full-info">
                    ${displayConditionally("최소레벨", expitem.min_lvl)}
                    ${displayConditionally("최대레벨", expitem.max_lvl)}
                    ${displayConditionally("경험치 증가량", expitem.Add_dream_exp)}
                    ${displayConditionally("지속시간", (expitem.Duration/1000))}
                    ${displayConditionally("쿨타임", (expitem.cooldownTime/1000))}
                </div>
            `;

            resultBox.innerHTML = expitemInfo + fullInfo;
            resultsContainer.appendChild(resultBox);
        }

        // 검색 버튼 클릭 시 검색 실행
        document.getElementById('searchButton').addEventListener('click', search);
    </script>
</body>
</html>
